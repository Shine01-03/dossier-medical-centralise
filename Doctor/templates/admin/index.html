{% extends 'admin/base.html' %}

{% load static %}

{% block body %}

      <main class="app-main">
        <!--begin::App Content Header-->
        <div class="app-content-header">
          <!--begin::Container-->
          <div class="container-fluid">
            <!--begin::Row-->
            <div class="row">
              <div class="col-sm-6"><h3 class="mb-0">Tableau de Bord </h3></div>
              <div class="col-sm-6">
                <ol class="breadcrumb float-sm-end">
                  <li class="nav-item">
                    
                    {% if is_medecin %}
                     
                     
                      <div class="d-flex justify-content-end gap-2">

                          <a href="{% url 'details_rendezvous' %}" class="btn btn-primary">
                              üìÖ Voir les rendez-vous
                          </a>
                      </div>

                    {% else %}  
                      
                      <a href="{% url 'exporter_medecins' %}" class="btn btn-dark float-end me-2">
                        <i class="bi bi-file-earmark-person-fill"></i> Exporter liste des m√©decins (PDF)
                      </a>

                      
                    {% endif %}

                   </li>
                </ol>
              </div>
            </div>
            <!--end::Row-->
          </div>
          <!--end::Container-->
        </div>
        <div class="app-content">
         <!--begin::Container-->
<div class="container-fluid">
  {% if is_medecin %}
    <div class="row">
      <!-- Patients suivis -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="info-box">
          <span class="info-box-icon bg-primary shadow-sm">
            <i class="bi bi-people-fill text-white"></i>
          </span>
          <div class="info-box-content">
            <span class="info-box-text">üë©‚Äç‚öïÔ∏è Patients suivis</span>
            <span class="info-box-number">{{ total_patients }}</span>
            <small>Total patients suivis</small>
          </div>
        </div>
      </div>

      <!-- Rendez-vous du jour -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="info-box">
          <span class="info-box-icon bg-success shadow-sm">
            <i class="bi bi-calendar-check-fill text-white"></i>
          </span>
          <div class="info-box-content">
            <span class="info-box-text">üìÖ Rendez-vous du jour</span>
            <span class="info-box-number">{{ rdv_du_jour }}</span>
            <small>Consultations pr√©vues</small>
          </div>
        </div>
      </div>

      <!-- Alertes m√©dicales -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="info-box">
          <span class="info-box-icon bg-danger shadow-sm">
            <i class="bi bi-exclamation-triangle-fill text-white"></i>
          </span>
          <div class="info-box-content">
            <span class="info-box-text">‚ö†Ô∏è Alertes m√©dicales</span>
            <span class="info-box-number">{{ alertes }}</span>
            <small>Valeurs critiques</small>
          </div>
        </div>
      </div>

      <!-- Consultations -->
      <div class="col-12 col-sm-6 col-md-3">
        <div class="info-box">
          <span class="info-box-icon bg-warning shadow-sm">
            <i class="bi bi-clipboard2-check-fill text-white"></i>
          </span>
          <div class="info-box-content">
            <span class="info-box-text">üìä Consultations</span>
            <span class="info-box-number">{{ consultations_mois }}</span>
            <small>Ce mois</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Dossiers r√©cents -->
    <div class="card mt-4">
      <div class="card-header bg-info text-white">
        üìë Dossiers r√©cents (5 derniers patients vus)
      </div>
      <div class="card-body p-0">
        <table class="table table-hover m-0">
          <thead>
            <tr>
              <th>Nom</th>
              <th>√Çge</th>
              <th>Motif</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            {% for consultation in dossiers_recents %}
              <tr>
                <td>{{ consultation.patient.nom }} {{ consultation.patient.prenoms }}</td>
                <td>{{ consultation.patient.age }} ans</td>
                <td>{{ consultation.diagnostic|truncatechars:40 }}</td>
                <td>{{ consultation.date|date:"d/m/Y" }}</td>
              </tr>
            {% empty %}
              <tr><td colspan="4" class="text-center">Aucune consultation enregistr√©e.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  {% else %}
    <!-- Widgets Admin -->
    <div class="row">
      <div class="col-md-3">
        <div class="info-box">
          <span class="info-box-icon bg-primary"><i class="bi bi-person-vcard"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">üë®‚Äç‚öïÔ∏è M√©decins enregistr√©s</span>
            <span class="info-box-number">{{ total_medecins }}</span>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div class="info-box">
          <span class="info-box-icon bg-dark"><i class="bi bi-gear-wide-connected"></i></span>
          <div class="info-box-content">
            <span class="info-box-text">üõ†Ô∏è Panneaux syst√®me</span>
            <span class="info-box-number">OK</span>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>
<!--end::Container-->

            <!-- /.row -->
            <!--begin::Row-->
             {% if is_medecin %} 
            <div class="row">

              <div class="col-md-12">
                <div class="card mb-4">
                  <div class="card-body">
                    <!--begin::Row-->
                    <div class="row">
                      <div class="col-md-12">
                        <p class="text-center">
                          <strong>Statistiques mensuelles de l'activit√© m√©dicale</strong>
                        </p>
                        <div id="sales-chart"></div>
                          <a href="{% url 'details_rendezvous' %}" class="btn btn-outline-primary mt-3">Voir les d√©tails</a>


                      </div>
                    
                    </div>
                    {% else %}  
                    
                    <div class="row">

                    <div class="col-md-12">
                      <div class="card mb-4">
                        <div class="card-body">
                          <!--begin::Row-->
                          <div class="row">
                            <div class="col-md-12">
                              <p class="text-center">
                                <strong>Vos Statistiques mensuelles</strong>
                              </p>
                              <div id="sales-chart"></div>
                                <a href="{% url 'details_rendezvous' %}" class="btn btn-outline-primary mt-3">D√©tails</a>


                            </div>
                    
                    </div>
                     {% endif %} 
                    <!--end::Row-->
                  </div>
                  <!-- ./card-body -->
                  <div class="card-footer">
                    <!--begin::Row-->
                    <div class="row">
                      <div class="col-md-3 col-6">
                       
                      </div>
                    </div>
        {% if is_medecin %} 

         {% else %}
                  <div class="row">
                    <div class="col-md-12">
                      <div class="card mb-4">
                        <div class="card-header">
                    <div class="card">
                      <div class="card-header">
                          <h3 class="card-title">Utilisateurs r√©cents</h3>
                          <table class="table">
                            <thead>
                              <tr>
                                <th>Photo</th>
                                <th>Nom</th>
                                <th>Pr√©nom</th>
                                <th>Sp√©cialit√©</th>
                                <th>Date d‚Äôajout</th>
                              </tr>
                            </thead>
                            <tbody>
                              {% for medecin in medecins_recents %}
                                <tr>
                                  <td>
                                    {% if medecin.photo_profil %}
                                      <img src="{{ medecin.photo_profil.url }}" alt="avatar" width="40" height="40" class="rounded-circle">
                                    {% else %}
                                      {% if medecin.sexe == "Homme" %}
                                        <img src="{% static 'img/avatars/avatar8.jpeg' %}" alt="avatar" width="40" height="40" class="rounded-circle">
                                      {% elif medecin.sexe == "Femme" %}
                                        <img src="{% static 'img/avatars/avatar12.jpeg' %}" alt="avatar" width="40" height="40" class="rounded-circle">
                                      {% else %}
                                        <img src="{% static 'img/avatars/avatarE.jpg' %}" alt="avatar" width="40" height="40" class="rounded-circle">
                                      {% endif %}
                                    {% endif %}
                                  </td>
                                  <td>{{ medecin.user.last_name }}</td>
                                  <td>{{ medecin.user.first_name }}</td>
                                  <td>{{ medecin.specialite }}</td>
                                  <td>{{ medecin.user.date_joined|date:"d M Y" }}</td>
                                </tr>
                              {% empty %}
                                <tr><td colspan="5">Aucun m√©decin r√©cemment ajout√©.</td></tr>
                              {% endfor %}
                            </tbody>
                          </table>

                        <div class="card-footer text-center">
                          <a href="{% url 'liste_medecins' %}">Voir tous les utilisateurs </a>
                        </div>
                      </div>
                    </div>
                 
                    <!--end::Row-->
                  </div>

                  <div class="card mt-3">
                    <div class="card-header">
                      <h3 class="card-title">Fonctionnalit√©s disponibles</h3>
                      <p>Nombre de fonctionnalit√©s : {{ fonctionnalites|length }}</p>

                    </div>
                    <div class="card-body p-0">
                      <div class="table-responsive">
                        <table class="table m-0">
                          <thead>
                            <tr>
                              <th>Code</th>
                              <th>Fonctionnalit√©</th>
                              <th>Statut</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for f in fonctionnalites %}
                              <tr>
                                <td>{{ f.code }}</td>
                                <td>{{ f.nom }}</td>
                                <td><span class="badge bg-primary">{{ f.statut }}</span></td>
                              </tr>
                            {% empty %}
                              <tr><td colspan="3">Aucune fonctionnalit√© disponible.</td></tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                    <!-- /.card-footer -->
                  </div>
                  <!-- /.card -->
                </div>
                <!-- /.col -->
              
              </div>
              <!--end::Row-->

          {% endif %}     
            </div>
            <!--end::Container-->
          </div>
                  <!-- /.card-footer -->
                </div>
                <!-- /.card -->
              </div>
              <!-- /.col -->
            </div>
            <!--end::Row-->
           
        <!--end::App Content-->
      </main>
  {% endblock %}
    
      